<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Osobní dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main id="dashboard" class="grid"></main>

  <script>
    const widgets = [
      { name: 'clock', width: 'full' },
      { name: 'calculator', width: 'half' },
      { name: 'ahoj', width: 'half' },
      { name: 'weather', width: 'half' },
      { name: 'exchange', width: 'half' },
      { name: 'todo', width: 'half' },
      { name: 'rozvrh', width: 'full' },

    ];

    async function loadWidgets() {
      const container = document.getElementById('dashboard');
      for (const widgetConfig of widgets) {
        // podpora pro string i objekt
        const widgetName = typeof widgetConfig === 'string' ? widgetConfig : widgetConfig.name;
        const widgetWidth = typeof widgetConfig === 'object' ? widgetConfig.width : null;

        if (!widgetName) {
          console.error('Widget nemá správně nastavené jméno', widgetConfig);
          continue;
        }
        
        // načíst widget
        const res = await fetch(`widgets/${widgetName}.html`);
        const html = await res.text();

        // vytvořit wrapper pro widget
        const widgetWrapper = document.createElement('div');
        widgetWrapper.className = 'widget';
        
        // přidat třídu pro šířku, pokud je specifikována
        if (widgetWidth) {
          widgetWrapper.classList.add(widgetWidth);
        }
        
        widgetWrapper.innerHTML = html;
        container.appendChild(widgetWrapper);
        
        // spustit skripty z widgetu
        const scripts = widgetWrapper.querySelectorAll('script');
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          newScript.textContent = oldScript.textContent;
          oldScript.parentNode.replaceChild(newScript, oldScript);
        });
      }
    }
    loadWidgets();
  </script>
</body>
</html>
